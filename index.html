<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>הסכם הזמנת משלוח ושירותים</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; direction: rtl; text-align: right; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: auto; background: rgba(255, 255, 255, 0.63); padding: 20px; border-radius: 10px; box-shadow: 0px 0px 10px rgba(0,0,0,0.1); }
        h1, h2 { text-align: center; }
        label { font-weight: bold; }
        input, select { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ccc; border-radius: 5px; }
        button { width: 100%; padding: 10px; background: hsl(241, 90%, 15%); color: white; border: none; border-radius: 5px; cursor: pointer; transition: background 0.3s ease; }
        button:hover { background: #090853; }
        canvas { border: 1px solid #ccc; margin-top: 10px; width: 100%; height: 200px; }
        .error { color: red; font-size: 0.9em; }
        .agreement { display: none; overflow-y: scroll; max-height: 300px; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>הסכם הזמנת משלוח ושירותים</h1>
        <button type="button" onclick="toggleAgreement()">הצג את ההסכם</button>
        <div class="agreement" id="agreementContent">
            <h2>הסכם הזמנת משלוח ושירותים</h2>
            <section>
                <h3>1. מבוא</h3>
                <p>
                    1.1. החברה מספקת שירותי איתור מפעלים עבור הלקוח, הזמנת דוגמאות, בדיקות תקינה ושירותי רכש למכולות ישירות מהמפעלים.
                    <br>1.2. הלקוח מעוניין לבצע הזמנה של מוצר(ים) באמצעות החברה, בהתאם לתהליך המוגדר בהסכם זה.
                    <br>1.3. הסכם זה מגדיר את שלבי העבודה, תנאי התשלום, האחריות וחלוקת הסיכונים בין הצדדים.
                </p>
            </section>
            <section>
                <h3>2. תהליך העבודה</h3>
                <p>
                    <strong>2.1. שלב ראשון – איתור מפעלים ודוגמה</strong>
                    <br>2.1.1. החברה תבצע עבור הלקוח איתור מפעלים מתאימים בהתאם לדרישותיו והמוצרים שיבקש.
                    <br>2.1.2. הלקוח יקבל קטלוג מוצרים רלוונטיים לצורך בחירת דוגמה להזמנה.
                    <br>2.1.3. לאחר בחירת הדוגמה על ידי הלקוח, החברה תבצע את ההזמנה בהתאם להנחיות הבאות:
                    <br>במקרה שהמוצר אינו דורש תקן – הזמנת הדוגמה תבוצע על שם הלקוח.
                    <br>במקרה שהמוצר דורש תקן – הזמנת הדוגמה תבוצע על שם VIPO CONNECT, לצורך טיפול בתהליך התקינה.
                    <br>2.1.4. הלקוח יבחר את שיטת השילוח של הדוגמה (שילוח ימי / שילוח אווירי).
                    <br>2.1.5. עלות המשלוח תבוצע ישירות מול אלדן 2000, אשר תנהל את השינוע בשם הלקוח או VIPO CONNECT, בהתאם למפורט בסעיף 2.1.3.
                    <br>2.1.6. לאחר קבלת הדוגמה, הלקוח יאשר בכתב את התאמתה לדרישותיו.
                    <br><strong>2.2. שלב שני – בדיקות תקינה (אם נדרש)</strong>
                    <br>2.2.1. אם המוצר דורש תקן, הדוגמה תישלח לבדיקה במכון התקנים בישראל על ידי VIPO CONNECT.
                    <br>2.2.2. החברה תבצע את תהליך התקינה בשם VIPO CONNECT, ותספק שירותי טיפול מול מכון התקנים בעלות של 1,500 ₪ (לא כולל אגרות ותשלומים נוספים הנדרשים על ידי מכון התקנים או גורמים חיצוניים נוספים).
                    <br>2.2.3. כל ההוצאות הנוספות הכרוכות בבדיקות התקינה (אגרות מכון התקנים, בדיקות נוספות וכו') יחולו על הלקוח וישולמו במישרין לגורמים הרלוונטיים או באמצעות VIPO CONNECT לפי הצורך.
                    <br><strong>2.3. שלב שלישי – הזמנה מסחרית (מכולה)</strong>
                    <br>2.3.1. לאחר אישור הדוגמה ו/או קבלת התקן (אם נדרש), תבוצע הזמנה מסחרית בהתאם להנחיות הבאות:
                    <br>במקרה שהמוצר אינו דורש תקן – הזמנת המכולה תבוצע על שם הלקוח, ותשונע ישירות אליו.
                    <br>במקרה שהמוצר דורש תקן – הזמנת המכולה תבוצע על שם VIPO CONNECT, והלקוח ירכוש את המוצרים מ-VIPO CONNECT לאחר קבלת הסחורה.
                    <br>2.3.2. הלקוח יבחר את שיטת השילוח של המכולה (שילוח ימי / שילוח אווירי).
                    <br>2.3.3. הלקוח ישלם 50% מערך ההזמנה + 10% עמלה לחברה לצורך תחילת הייצור.
                    <br>2.3.4. המפעל יתחיל את הייצור מיד עם קבלת התשלום.
                    <br><strong>2.4. שלב רביעי – בדיקת איכות וסיום תשלום</strong>
                    <br>2.4.1. עם סיום הייצור, נציג מטעם VIPO CONNECT יבדוק את הסחורה במפעל.
                    <br>2.4.2. לאחר הבדיקה, הלקוח ישלם את יתרת התשלום: 50% מערך ההזמנה + 10% עמלה לחברה.
                    <br>2.4.3. לאחר קבלת מלוא התשלום, יבוצע השינוע באמצעות אלדן 2000:
                    <br>במקרה שההזמנה בוצעה על שם הלקוח (מוצר ללא תקן) – המשלוח יתבצע ישירות על שמו של הלקוח.
                    <br>במקרה שההזמנה בוצעה על שם VIPO CONNECT (מוצר עם תקן) – הסחורה תגיע ל-VIPO CONNECT, והלקוח ירכוש את המוצרים מ-VIPO CONNECT בהתאם להסכם הרכישה בין הצדדים.
                    <br>2.4.4. השילוח יתבצע תוך אחריותו הבלעדית של הלקוח להתקשרות מול חברת השילוח, למעט במקרה שהסחורה מיובאת על שם VIPO CONNECT.
                </p>
            </section>
            <section>
                <h3>3. תנאי תשלום</h3>
                <p>
                    3.1. כל התשלומים יתבצעו בהעברה בנקאית לחשבון החברה, אלא אם סוכם אחרת בכתב.
                    <br>3.2. כל תשלום עבור דוגמאות, תקינה ושירותים נוספים יבוצע מראש.
                    <br>בהתאם לסעיף 2.2.2 לעיל, טיפול בתקן יעלה ללקוח 1,500 ₪ לא כולל אגרות מכון התקנים ותשלומים נוספים.
                    <br>3.3. במקרה של הזמנת מכולה, הייצור יחל רק לאחר קבלת 50% + 10% עמלה.
                    <br>3.4. יתרת התשלום (50% + 10% עמלה) תשולם לפני המשלוח.
                    <br>3.5. עמלת VIPO CONNECT הינה 10% מערך העסקה בסין, אך לא פחות מ-10,000 ₪ לכל עסקה.
                    <br>3.6. העמלה תשולם בשני חלקים:
                    <br>- <strong>בשלב הראשון:</strong> הלקוח ישלם 10% מערך העסקה או 5,000 ₪ (הגבוה מביניהם) בעת ביצוע ההזמנה.
                    <br>- <strong>בשלב השני:</strong> הלקוח ישלם את יתרת העמלה כך שסך כל העמלה המצטברת תעמוד על 10% מערך העסקה, אך לא פחות מ-10,000 ₪, לפני ביצוע השילוח.
                    <br>3.7. הלקוח מחויב בתשלום מלוא העמלה גם במקרה של ביטול העסקה לאחר שהייצור החל.
                    <br>3.8. <strong>פתיחת תיק יבוא:</strong>
                    <br>לצורך תחילת טיפול בהזמנת הלקוח, לרבות איתור מפעלים, הזמנת דוגמאות ובדיקות תקינה (ככל שיידרש), הלקוח מחויב לשלם סך של 1,500 ₪ עבור פתיחת תיק יבוא.
                    <br>תשלום זה אינו מוחזר בכל מקרה, והוא מהווה תנאי סף לתחילת הטיפול בהזמנת הלקוח.
                </p>
            </section>
            <section>
                <h3>4. אחריות והגבלת אחריות</h3>
                <p>
                    4.1. החברה מתחייבת כי איכות הסחורה שהמפעל ייצר תהיה תואמת לדוגמה שהלקוח אישר במאה אחוז (100%), בהתאם למפרט שסוכם מול הלקוח.
                    <br>4.2. החברה מתחייבת לעמוד מול המפעל היצרני בנוגע לאחריות שהמפעל מספק על המוצר שהוזמן:
                    <br>האחריות על המוצרים כפופה לתנאי האחריות של המפעל בלבד.
                    <br>במידה ונדרשים חלקי חילוף במסגרת האחריות של המפעל, החברה תדאג לספק ללקוח את החלקים בהתאם לאחריות שניתנה.
                    <br>עלות המשלוח של חלקי החילוף חלה על הלקוח, אשר יוכל לבחור אם לשלוח אותם באמצעות שילוח אווירי או ימי, בהתאם להעדפתו ולעלויות הכרוכות בכך.
                    <br>4.3. הלקוח אחראי לוודא את התאמת הדוגמה להזמנה לפני ביצוע הזמנה מסחרית.
                    <br>4.4. <strong>ביטול עסקה:</strong>
                    <br>לאחר ביצוע התשלום הראשון של 50% מערך העסקה, הלקוח אינו רשאי לבטל את ההזמנה במפעל.
                    <br>במקרה של ביטול מצד הלקוח, הסכום שהועבר 50% מערך העסקה יישאר ברשות המפעל ולא יוחזר ללקוח.
                </p>
            </section>
        </div>
        <form id="contractForm">
            <h2>פרטי הלקוח</h2>
            <label for="customerName">שם מלא:</label>
            <input type="text" id="customerName" required>
            <span class="error" id="nameError"></span>

            <label for="customerID">תעודת זהות / דרכון:</label>
            <input type="text" id="customerID" required>
            <span class="error" id="idError"></span>

            <label for="customerEmail">אימייל:</label>
            <input type="email" id="customerEmail" required>
            <span class="error" id="emailError"></span>

            <label for="customerAddress">כתובת:</label>
            <input type="text" id="customerAddress" required>
            <span class="error" id="addressError"></span>

            <label for="customerBusiness">עוסק מורשה / ח.פ.:</label>
            <input type="text" id="customerBusiness" required>
            <span class="error" id="businessError"></span>

            <h2>פרטי הדוגמה</h2>
            <label for="sampleProduct">שם המוצר:</label>
            <input type="text" id="sampleProduct" required>
            <span class="error" id="productError"></span>

            <label for="sampleQuantity">כמות:</label>
            <input type="number" id="sampleQuantity" required>
            <span class="error" id="quantityError"></span>

            <label for="samplePrice">מחיר הדוגמה (₪):</label>
            <input type="number" id="samplePrice" required>
            <span class="error" id="priceError"></span>

            <label for="sampleShipping">שיטת משלוח:</label>
            <select id="sampleShipping">
                <option value="ים">שילוח ימי</option>
                <option value="אוויר">שילוח אווירי</option>
            </select>

            <h2>פרטי ההזמנה המסחרית</h2>
            <label for="orderProduct">שם המוצר:</label>
            <input type="text" id="orderProduct" required>
            <span class="error" id="orderProductError"></span>

            <label for="orderQuantity">כמות:</label>
            <input type="number" id="orderQuantity" required>
            <span class="error" id="orderQuantityError"></span>

            <label for="orderPrice">מחיר המכולה (₪):</label>
            <input type="number" id="orderPrice" required>
            <span class="error" id="orderPriceError"></span>

            <label for="orderShipping">שיטת משלוח:</label>
            <select id="orderShipping">
                <option value="ים">שילוח ימי</option>
                <option value="אוויר">שילוח אווירי</option>
            </select>

            <h2>חתימה דיגיטלית</h2>
            <canvas id="signaturePad"></canvas>
            <button type="button" onclick="clearSignature()">נקה חתימה</button>

            <label><input type="checkbox" id="agreementCheckbox" required> אני מאשר שקראתי את ההסכם</label>

            <button type="submit">שלח והורד PDF</button>
        </form>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof emailjs !== 'undefined') {
                console.log('EmailJS loaded successfully');
                emailjs.init('hheJIrV1rPBQRPdWf');
            } else {
                console.error('EmailJS failed to load');
                alert('שגיאה: ספריית EmailJS לא נטענה. אנא נסה לרענן את הדף.');
            }
            
            if (typeof html2canvas === 'undefined') {
                console.error('html2canvas failed to load');
                alert('שגיאה: ספריית html2canvas לא נטענה. אנא נסה לרענן את הדף.');
            }
        });

        const canvas = document.getElementById('signaturePad');
        const ctx = canvas.getContext('2d');
        let drawing = false;

        function getMousePos(canvas, evt) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: evt.clientX - rect.left,
                y: evt.clientY - rect.top
            };
        }

        function getTouchPos(canvas, touch) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: touch.touches[0].clientX - rect.left,
                y: touch.touches[0].clientY - rect.top
            };
        }

        canvas.addEventListener('mousedown', (e) => {
            drawing = true;
            ctx.beginPath();
        });

        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            drawing = true;
            const pos = getTouchPos(canvas, e);
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
        });

        canvas.addEventListener('mouseup', () => {
            drawing = false;
            ctx.beginPath();
        });

        canvas.addEventListener('touchend', () => {
            drawing = false;
            ctx.beginPath();
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!drawing) return;
            const pos = getMousePos(canvas, e);
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.strokeStyle = '#000';
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
        });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (!drawing) return;
            const pos = getTouchPos(canvas, e);
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.strokeStyle = '#000';
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
        });

        function clearSignature() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function hasSignature() {
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
            for (let i = 3; i < imageData.length; i += 4) {
                if (imageData[i] > 0) {
                    return true;
                }
            }
            return false;
        }

        function toggleAgreement() {
            const agreement = document.getElementById('agreementContent');
            if (agreement.style.display === 'none') {
                agreement.style.display = 'block';
            } else {
                agreement.style.display = 'none';
            }
        }

        const form = document.getElementById('contractForm');
        form.addEventListener('submit', function(event) {
            event.preventDefault();
            generatePDFandSendEmail();
        });

        async function generatePDFandSendEmail() {
            try {
                if (!hasSignature()) {
                    alert('נא לחתום לפני שליחת הטופס');
                    return;
                }
                
                const customerName = document.getElementById('customerName').value;
                const customerID = document.getElementById('customerID').value;
                const customerEmail = document.getElementById('customerEmail').value;
                const customerAddress = document.getElementById('customerAddress').value;
                const customerBusiness = document.getElementById('customerBusiness').value;
                const sampleProduct = document.getElementById('sampleProduct').value;
                const sampleQuantity = document.getElementById('sampleQuantity').value;
                const samplePrice = document.getElementById('samplePrice').value;
                const sampleShipping = document.getElementById('sampleShipping').value;
                const orderProduct = document.getElementById('orderProduct').value;
                const orderQuantity = document.getElementById('orderQuantity').value;
                const orderPrice = document.getElementById('orderPrice').value;
                const orderShipping = document.getElementById('orderShipping').value;

                const tempDiv = document.createElement('div');
                tempDiv.style.position = 'absolute';
                tempDiv.style.left = '-9999px';
                tempDiv.style.fontFamily = 'Arial, Helvetica, sans-serif';
                tempDiv.style.direction = 'rtl';
                tempDiv.style.textAlign = 'right';
                tempDiv.style.width = '800px';
                tempDiv.style.backgroundColor = 'white';
                tempDiv.style.padding = '20px';
                
                tempDiv.innerHTML = `
                    <h1 style="text-align: center; color: #3366cc;">הסכם הזמנת משלוח ושירותים</h1>
                    
                    <div style="margin-top: 20px; border: 1px solid #ccc; padding: 15px; border-radius: 5px;">
                        <h2 style="border-bottom: 1px solid #ddd; padding-bottom: 10px;">פרטי הלקוח</h2>
                        <p><strong>שם מלא:</strong> ${customerName}</p>
                        <p><strong>תעודת זהות / דרכון:</strong> ${customerID}</p>
                        <p><strong>אימייל:</strong> ${customerEmail}</p>
                        <p><strong>כתובת:</strong> ${customerAddress}</p>
                        <p><strong>עוסק מורשה / ח.פ.:</strong> ${customerBusiness}</p>
                    </div>
                    
                    <div style="margin-top: 20px; border: 1px solid #ccc; padding: 15px; border-radius: 5px;">
                        <h2 style="border-bottom: 1px solid #ddd; padding-bottom: 10px;">פרטי הדוגמה</h2>
                        <p><strong>שם המוצר:</strong> ${sampleProduct}</p>
                        <p><strong>כמות:</strong> ${sampleQuantity}</p>
                        <p><strong>מחיר הדוגמה:</strong> ${samplePrice} ₪</p>
                        <p><strong>שיטת משלוח:</strong> ${sampleShipping}</p>
                    </div>
                    
                    <div style="margin-top: 20px; border: 1px solid #ccc; padding: 15px; border-radius: 5px;">
                        <h2 style="border-bottom: 1px solid #ddd; padding-bottom: 10px;">פרטי ההזמנה המסחרית</h2>
                        <p><strong>שם המוצר:</strong> ${orderProduct}</p>
                        <p><strong>כמות:</strong> ${orderQuantity}</p>
                        <p><strong>מחיר המכולה:</strong> ${orderPrice} ₪</p>
                        <p><strong>שיטת משלוח:</strong> ${orderShipping}</p>
                    </div>
                    
                    <div style="margin-top: 20px; border: 1px solid #ccc; padding: 15px; border-radius: 5px;">
                        <h2 style="border-bottom: 1px solid #ddd; padding-bottom: 10px;">אישור הלקוח</h2>
                        <p><strong style="color: #3366cc;">✓ אני מאשר/ת שקראתי את ההסכם ואני מסכים/ה לתנאיו</strong></p>
                    </div>
                    
                    <div style="margin-top: 20px; border: 1px solid #ccc; padding: 15px; border-radius: 5px;">
                        <h2 style="border-bottom: 1px solid #ddd; padding-bottom: 10px;">חתימה</h2>
                        <p><strong>תאריך:</strong> ${new Date().toLocaleDateString('he-IL')}</p>
                        <p><strong>שם החותם:</strong> ${customerName}</p>
                        <div id="signatureImage" style="margin-top: 10px;"></div>
                    </div>
                `;
                
                document.body.appendChild(tempDiv);
                
                const signatureImage = document.createElement('img');
                signatureImage.src = canvas.toDataURL('image/png');
                signatureImage.style.width = '200px';
                signatureImage.style.height = '100px';
                signatureImage.style.border = '1px solid #ddd';
                document.getElementById('signatureImage').appendChild(signatureImage);
                
                await new Promise(resolve => setTimeout(resolve, 500));
                
                const html2canvasScript = document.createElement('script');
                html2canvasScript.src = 'https://html2canvas.hertzen.com/dist/html2canvas.min.js';
                document.head.appendChild(html2canvasScript);
                
                html2canvasScript.onload = async function() {
                    const canvas = await html2canvas(tempDiv);
                    const imageDataUrl = canvas.toDataURL('image/jpeg', 0.7);
                    
                    document.body.removeChild(tempDiv);
                    
                    const downloadLink = document.createElement('a');
                    downloadLink.href = imageDataUrl;
                    downloadLink.download = `הסכם_${customerName.replace(/\s+/g, '_')}.jpg`;
                    downloadLink.click();
                    
                    const emailText = `
הסכם הזמנת משלוח ושירותים - VIPO CONNECT

פרטי הלקוח:
=============
שם מלא: ${customerName}
תעודת זהות / דרכון: ${customerID}
אימייל: ${customerEmail}
כתובת: ${customerAddress}
עוסק מורשה / ח.פ.: ${customerBusiness}

פרטי הדוגמה:
=============
שם המוצר: ${sampleProduct}
כמות: ${sampleQuantity}
מחיר הדוגמה: ${samplePrice} ₪
שיטת משלוח: ${sampleShipping}

פרטי ההזמנה המסחרית:
===================
שם המוצר: ${orderProduct}
כמות: ${orderQuantity}
מחיר המכולה: ${orderPrice} ₪
שיטת משלוח: ${orderShipping}

אישור הלקוח:
=============
✓ הלקוח אישר שקרא את ההסכם והסכים לתנאיו
✓ הלקוח חתם אלקטרונית על ההסכם
תאריך: ${new Date().toLocaleDateString('he-IL')}

=======================
הערה: תמונה של ההסכם החתום נשמרה במחשב המקומי ללקוח.
`;
                    
                    if (typeof emailjs === 'undefined') {
                        throw new Error('ספריית EmailJS לא נטענה. אנא נסה לרענן את הדף.');
                    }
                    
                    const requestId = Date.now().toString();
                    
                    console.log('Sending email to customer...');
                    try {
                        const response = await emailjs.send('service_ju86i0z', 'template_6pp16wq', {
                            to_name: customerName,
                            to_email: customerEmail,
                            from_name: 'VIPO CONNECT',
                            subject: 'הסכם הזמנת משלוח ושירותים',
                            message: emailText,
                            reply_to: 'vipo.m1985@gmail.com',
                            request_id: requestId
                        });
                        
                        console.log('Email sent to customer:', response);
                        
                        try {
                            const adminResponse = await emailjs.send('service_ju86i0z', 'template_6pp16wq', {
                                to_name: 'מנהל VIPO',
                                to_email: 'vipo.m1985@gmail.com',
                                from_name: 'מערכת VIPO',
                                subject: `הסכם חדש - ${customerName}`,
                                message: emailText,
                                reply_to: customerEmail,
                                request_id: requestId + '-admin'
                            });
                            
                            console.log('Email sent to admin:', adminResponse);
                            alert('המייל נשלח בהצלחה ללקוח ולמנהל! תמונת ההסכם נשמרה במחשב שלך.');
                        } catch (adminError) {
                            console.error('Email sending to admin failed:', adminError);
                            alert('המייל נשלח ללקוח בהצלחה, אך המייל למנהל נכשל. תמונת ההסכם נשמרה במחשב שלך.');
                        }
                    } catch (customerError) {
                        console.error('Email sending to customer failed:', customerError);
                        alert('שליחת המייל ללקוח נכשלה. בדוק את חיבור האינטרנט ופרטי המייל.\n\nתמונת ההסכם נשמרה במחשב שלך.');
                    }
                };
            } catch (error) {
                console.error('Error in form generation:', error);
                alert('אירעה שגיאה: ' + error.message);
            }
        }
    </script>
</body>
</html>
